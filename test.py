# -*- coding: utf-8 -*-
import streamlit as st
import pandas as pd
import plotly.express as px
from textblob import TextBlob

st.set_page_config(page_title="ë§ˆìŒ ì˜¨ë„ê³„ â€“ ìì‚´ ì˜ˆë°© ì§€ì›", layout="wide")
st.title("ğŸ’› ë§ˆìŒ ì˜¨ë„ê³„ â€“ ìì‚´ ì˜ˆë°© ì§€ì› ëŒ€ì‹œë³´ë“œ")

# -------------------------------
# 1ï¸âƒ£ ì˜¤ëŠ˜ì˜ ë§ˆìŒ ì²´í¬
# -------------------------------
st.header("1ï¸âƒ£ ì˜¤ëŠ˜ì˜ ë§ˆìŒì„ ì²´í¬í•´ë³´ì„¸ìš”")
st.markdown("ê°„ë‹¨íˆ í•œ ë¬¸ì¥ìœ¼ë¡œ ì§€ê¸ˆ ê¸°ë¶„ì„ í‘œí˜„í•˜ê±°ë‚˜ ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.")

# ì˜µì…˜ 1: ê°ì • ì„ íƒ
emotion = st.selectbox("ê¸°ë¶„ ì„ íƒ", ["ğŸ˜Š í–‰ë³µ", "ğŸ˜ ë³´í†µ", "ğŸ˜” ìŠ¬í””", "ğŸ˜¢ ì™¸ë¡œì›€", "ğŸ˜¡ í™”ë‚¨", "ğŸ˜° ë¶ˆì•ˆ"])

# ì˜µì…˜ 2: ììœ  í…ìŠ¤íŠ¸ ì…ë ¥
text_input = st.text_area("ììœ ë¡­ê²Œ ì§€ê¸ˆ ê¸°ë¶„ì„ ì ì–´ë³´ì„¸ìš” (ì„ íƒ)")

# -------------------------------
# 2ï¸âƒ£ ê°ì • ë¶„ì„ + ìœ„í—˜ë„
# -------------------------------
st.header("2ï¸âƒ£ ë¶„ì„ ê²°ê³¼")

def analyze_emotion(text, selected_emotion):
    if text.strip() != "":
        blob = TextBlob(text)
        polarity = blob.sentiment.polarity  # -1 ~ +1
        if polarity < -0.5:
            risk = "ë†’ìŒ âš ï¸"
            feedback = "ì§€ê¸ˆ í˜ë“  ê°ì •ì„ ëŠë¼ê³  ìˆë„¤ìš”. í˜¼ìê°€ ì•„ë‹ˆì—ìš”."
        elif polarity < 0:
            risk = "ë³´í†µ âš "
            feedback = "ì¡°ê¸ˆ ìš°ìš¸í•œ ê¸°ë¶„ì´ ìˆêµ°ìš”. ì‘ì€ ì‚°ì±…ì´ë‚˜ íœ´ì‹ì´ ë„ì›€ë  ìˆ˜ ìˆì–´ìš”."
        else:
            risk = "ë‚®ìŒ âœ…"
            feedback = "ì¢‹ì•„ìš”! ì˜¤ëŠ˜ ê¸°ë¶„ì´ ë¹„êµì  ì•ˆì •ì ì´ì—ìš”."
    else:
        # ì„ íƒ ê°ì • ê¸°ë°˜ ê°„ë‹¨ ìœ„í—˜ë„
        if selected_emotion in ["ğŸ˜” ìŠ¬í””", "ğŸ˜¢ ì™¸ë¡œì›€", "ğŸ˜° ë¶ˆì•ˆ"]:
            risk = "ë³´í†µ âš "
            feedback = "ì¡°ê¸ˆ ìš°ìš¸í•˜ê±°ë‚˜ ì™¸ë¡œìš´ ê°ì •ì´ ìˆêµ°ìš”. ìŠ¤ìŠ¤ë¡œ ëŒë³´ëŠ” ì‹œê°„ì„ ê°€ì§€ì„¸ìš”."
        else:
            risk = "ë‚®ìŒ âœ…"
            feedback = "ì¢‹ì•„ìš”! ì˜¤ëŠ˜ ê¸°ë¶„ì´ ë¹„êµì  ì•ˆì •ì ì´ì—ìš”."
    return risk, feedback

risk_level, feedback_text = analyze_emotion(text_input, emotion)
st.metric(label="í˜„ì¬ ìœ„í—˜ë„", value=risk_level)
st.info(feedback_text)

# -------------------------------
# 3ï¸âƒ£ ìƒë‹´ ë° ë„ì›€ ì •ë³´
# -------------------------------
st.header("3ï¸âƒ£ ê¸´ê¸‰ ìƒë‹´/ì§€ì› ì •ë³´")

st.markdown("""
- â˜ï¸ **1393**: ìì‚´ì˜ˆë°©ìƒë‹´ì „í™”  
- â˜ï¸ **1588-9191**: ìƒëª…ì˜ì „í™”  
- â˜ï¸ **1577-0199**: ì •ì‹ ê±´ê°•ìƒë‹´  
- ì§€ì—­ë³„ ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„° ê²€ìƒ‰: [ë°”ë¡œê°€ê¸°](https://www.mindmap.or.kr)
""")

# -------------------------------
# 4ï¸âƒ£ ìì‚´ë¥  í†µê³„ ì‹œê°í™”
# -------------------------------
st.header("4ï¸âƒ£ ì—°ë ¹ë³„/ì„±ë³„ ìì‚´ë¥  í†µê³„ (ìƒ˜í”Œ ë°ì´í„°)")

# ìƒ˜í”Œ í†µê³„ ë°ì´í„°
data = {
    "ì—°ë ¹ëŒ€": ["10ëŒ€","20ëŒ€","30ëŒ€","40ëŒ€","50ëŒ€","60ëŒ€"],
    "ë‚¨ì„± ìì‚´ë¥ ": [8, 22, 30, 35, 40, 45],
    "ì—¬ì„± ìì‚´ë¥ ": [5, 12, 18, 20, 25, 30]
}
df = pd.DataFrame(data)

fig = px.bar(df, x="ì—°ë ¹ëŒ€", y=["ë‚¨ì„± ìì‚´ë¥ ","ì—¬ì„± ìì‚´ë¥ "], barmode="group",
             labels={"value":"ìì‚´ë¥  (ëª…/10ë§Œëª…)", "ì—°ë ¹ëŒ€":"ì—°ë ¹ëŒ€"})
st.plotly_chart(fig, use_container_width=True)

st.markdown("â€» ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì—°ë ¹ë³„Â·ì„±ë³„ ìì‚´ë¥  ë³€í™”ë¥¼ ì‹œê°í™”í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.")
